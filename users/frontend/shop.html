<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AURORA</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&family=Playfair+Display:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="icon" href="../assets/logo.png" type="image/png" />
  <style>
    :root {
      --ivory: #f9f7f4;
      --porcelain: #ffffff;
      --ink: #111111;
      --sand: #e7e1d7;
      --mist: #f2efea;
      --stone: #c8c1b7;
      --gold: #bfa77a;
    }

    body {
      font-family: "Montserrat", "Helvetica Neue", Arial, sans-serif;
      background: var(--ivory);
      background-image:
        radial-gradient(circle at 12% 18%, rgba(231, 225, 215, 0.6), transparent 45%),
        radial-gradient(circle at 88% 10%, rgba(242, 239, 234, 0.8), transparent 40%),
        radial-gradient(circle at 80% 80%, rgba(231, 225, 215, 0.4), transparent 45%);
      color: var(--ink);
    }

    .font-serif {
      font-family: "Playfair Display", "Times New Roman", serif;
    }

    .hairline {
      letter-spacing: 0.35em;
    }

    .lux-outline {
      border: 1px solid var(--ink);
      padding: 0.75rem 1.5rem;
      transition: all 0.3s ease;
    }

    .lux-outline:hover {
      background: var(--ink);
      color: var(--porcelain);
    }

    .ghost-btn {
      border: 1px solid var(--ink);
      padding: 0.6rem 1.2rem;
      font-size: 0.85rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      transition: all 0.3s ease;
    }

    .ghost-btn:hover {
      background: var(--ink);
      color: var(--porcelain);
    }

    .input-clean {
      border: 1px solid var(--sand);
      background: var(--porcelain);
      padding: 0.75rem 0.9rem;
    }

    .input-clean:focus {
      outline: none;
      border-color: var(--ink);
      box-shadow: 0 0 0 2px rgba(17, 17, 17, 0.08);
    }

    .search-field {
      display: flex;
      align-items: center;
      gap: 0.65rem;
      border: 1px solid var(--sand);
      background: var(--porcelain);
      padding: 0.75rem 1rem;
      border-radius: 999px;
      box-shadow: 0 12px 30px rgba(17, 17, 17, 0.08);
      transition: border-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
    }

    .search-field:focus-within {
      border-color: var(--ink);
      box-shadow: 0 18px 40px rgba(17, 17, 17, 0.12);
      transform: translateY(-1px);
    }

    .search-icon {
      width: 18px;
      height: 18px;
      color: #6b6b6b;
      flex-shrink: 0;
    }

    .search-input {
      border: none;
      outline: none;
      background: transparent;
      width: 100%;
      font-size: 0.95rem;
      color: var(--ink);
    }

    .search-input::placeholder {
      color: #9a9a9a;
      letter-spacing: 0.04em;
    }

    .sticky-controls {
      position: sticky;
      top: 0;
      z-index: 40;
     
      backdrop-filter: blur(10px);
      border-bottom: none;
      padding: 1rem 0;
      margin-bottom: 2rem;
    }

    @media (max-width: 767px) {
      .sticky-controls {
        position: static;
        backdrop-filter: none;
      }
    }

    .controls-wrap {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    @media (min-width: 768px) {
      .controls-wrap {
        grid-template-columns: 1.2fr 0.6fr;
        align-items: center;
      }
    }

    #products article {
      background: var(--porcelain);
      border: 1px solid var(--sand);
      border-radius: 1rem;
      box-shadow: none;
      transition: transform 0.35s ease, border-color 0.35s ease;
    }

    #products article:hover {
      transform: translateY(-4px);
      border-color: var(--ink);
      box-shadow: none;
    }

    #products img {
      background: var(--mist);
      transition: transform 0.5s ease;
    }

    #products article:hover img {
      transform: scale(1.04);
    }

    .section-divider {
      border-top: 1px solid var(--sand);
    }

    .soft-card {
      background: var(--porcelain);
      border: 1px solid var(--sand);
      box-shadow: 0 18px 40px rgba(17, 17, 17, 0.06);
    }

    .hero-layer {
      background: linear-gradient(120deg, rgba(249, 247, 244, 0.92) 0%, rgba(249, 247, 244, 0.6) 50%, rgba(249, 247, 244, 0.25) 100%);
    }

    .hero-shell {
      position: relative;
      overflow: hidden;
      border-radius: 1.5rem;
      border: 1px solid var(--sand);
      min-height: 360px;
      background: var(--porcelain);
    }

    .hero-media {
      position: absolute;
      inset: 0;
      background-image: url("https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=2000&q=80");
      background-size: cover;
      background-position: center;
      transform: scale(1.02);
    }

    .hero-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(120deg, rgba(249, 247, 244, 0.92) 0%, rgba(249, 247, 244, 0.6) 55%, rgba(249, 247, 244, 0.1) 100%);
    }

    .hero-content {
      position: relative;
      z-index: 1;
      padding: 4rem 3rem;
      max-width: 520px;
    }

    .hero-kicker {
      font-size: 0.7rem;
      letter-spacing: 0.35em;
      text-transform: uppercase;
      color: #6b6b6b;
    }

    .hero-title {
      font-family: "Playfair Display", "Times New Roman", serif;
      font-size: 2.75rem;
      line-height: 1.1;
      margin-top: 0.8rem;
    }

    .hero-copy {
      margin-top: 1rem;
      font-size: 0.95rem;
      color: #5f5f5f;
    }

    .hero-cta {
      margin-top: 1.8rem;
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
    }

    .fade-up {
      animation: fadeUp 0.8s ease both;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(14px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 768px) {
      .hero-content { padding: 3rem 2rem; }
      .hero-title { font-size: 2.2rem; }
    }

    #product-modal input,
    #product-modal select,
    #pack-modal input,
    #pack-modal select {
      border: 1px solid var(--sand);
      border-radius: 0.5rem;
      padding: 0.6rem 0.8rem;
    }

    #product-modal input:focus,
    #product-modal select:focus,
    #pack-modal input:focus,
    #pack-modal select:focus {
      outline: none;
      border-color: var(--ink);
      box-shadow: 0 0 0 2px rgba(17, 17, 17, 0.08);
    }

    #order-submit,
    #pack-next,
    #pack-submit {
      background: var(--ink) !important;
      color: var(--porcelain) !important;
      border: 1px solid var(--ink) !important;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      padding: 0.7rem 1.5rem;
      transition: all 0.3s ease;
    }

    #order-submit:hover,
    #pack-next:hover,
    #pack-submit:hover {
      background: transparent !important;
      color: var(--ink) !important;
    }

    #pack-back {
      border: 1px solid var(--stone);
      background: transparent;
      color: var(--ink);
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 0.7rem 1.2rem;
    }
  </style>
</head>
<body class="text-neutral-900">
  <div class="min-h-screen">
    <div class="bg-white text-xs tracking-[0.3em] text-center py-2 uppercase">
      Livraison au Maroc 
    </div>

    <header class="max-w-7xl mx-auto px-6 py-6 flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <img src="../assets/logo.png" alt="AURORA" class="h-10 w-10 object-contain" onerror="this.style.display='none'" />
        <div>
          <div class="text-2xl font-serif">AURORA</div>
        </div>
      </div>
      <nav class="hidden md:flex items-center space-x-8 text-sm">
        <a href="BESOIN_DAIDE/faq.html" class="hover:underline">FAQ</a>
        <a href="BESOIN_DAIDE/contact.html" class="hover:underline">Contact</a>
        <a href="BESOIN_DAIDE/conditions-generales-vente.html" class="hover:underline">Livraison</a>
      </nav>
      <div class="flex items-center space-x-4">
        <!-- Desktop: Text button -->
        <button id="open-pack-btn" class="ghost-btn hidden sm:flex">Composer un pack</button>
        <!-- Mobile: Clickable animation -->
        <div id="pack-animation-btn" class="flex sm:hidden items-center justify-center cursor-pointer" style="width: 48px; height: 48px;">
          <div id="pack-lottie" style="width: 100%; height: 100%;"></div>
        </div>
        <div class="flex items-center space-x-3">
          <button aria-label="Recherche">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="7"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          </button>
          <button id="orders-btn" aria-label="Mes commandes" title="Historique de commandes">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
          </button>
        </div>
      </div>
    </header>
   


    <section class="max-w-6xl mx-auto px-6 py-14">
      <div class="soft-card rounded-2xl p-10 text-center">
        <p class="text-xs uppercase hairline">Maison Aurora</p>
        <h2 class="mt-4 text-3xl font-serif">L'art du minimalisme precis</h2>
        <p class="mt-4 text-sm text-neutral-600">Un univers epure, des textures nobles, et une selection rigoureuse pour sublimer votre rituel quotidien.</p>
      </div>
    </section>

    <section class="max-w-7xl mx-auto px-6 pb-16">
      <div class="sticky-controls">
        <div class="controls-wrap">
          <div>
             <div class="search-field mt-4">
              <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <circle cx="11" cy="11" r="7"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
              <input id="search-input" type="search" placeholder="Rechercher un produit..." class="search-input" />
            </div>
          </div>
          <div>
             <select id="filter-select" class="search-field mt-4">
              <option value="all">Filtrer</option>
              <option value="promo">En promotion</option>
              <option value="price_asc">Prix: croissant</option>
              <option value="price_desc">Prix: decroissant</option>
            </select>
          </div>
        </div>
      </div>

      <main>
        <div id="products" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-10"></div>
      </main>
    </section>

    <section class="bg-white">
      <div class="max-w-7xl mx-auto px-6 py-16">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-10 text-center">
          <div>
            <p class="text-xs uppercase hairline">01</p>
            <h3 class="mt-3 text-xl font-serif">Sourcing maitrise</h3>
            <p class="mt-3 text-sm text-neutral-600">Matieres selectionnees avec exigence et transparence.</p>
          </div>
          <div>
            <p class="text-xs uppercase hairline">02</p>
            <h3 class="mt-3 text-xl font-serif">Gestes essentiels</h3>
            <p class="mt-3 text-sm text-neutral-600">Formules et coupes concues pour l'intemporel.</p>
          </div>
          <div>
            <p class="text-xs uppercase hairline">03</p>
            <h3 class="mt-3 text-xl font-serif">Service prive</h3>
            <p class="mt-3 text-sm text-neutral-600">Conseil discret, experience fluide et personnalisable.</p>
          </div>
        </div>
      </div>
    </section>

  <!-- Product detail modal -->
  <div id="product-modal" class="fixed inset-0 bg-black/40 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg w-full max-w-2xl sm:w-11/12 p-4 sm:p-6 shadow-lg max-h-[85vh] overflow-y-auto">
      <div class="flex justify-between items-start">
        <h2 id="pm-name" class="text-lg font-semibold">Produit</h2>
        <button id="pm-close" class="text-gray-500 hover:text-gray-800">✕</button>
      </div>
      <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <img id="pm-image" src="" alt="" class="w-full h-48 sm:h-56 md:h-64 object-cover rounded" />
        </div>
        <div>
          <div id="pm-unit" class="text-sm text-gray-600"></div>
          <div id="pm-price" class="mt-2 text-xl font-bold"></div>
          <div id="pm-delivery" class="mt-2 text-sm text-gray-700"></div>
          <div id="pm-total" class="mt-2 text-lg font-semibold"></div>
          <div id="pm-stock" class="mt-2 text-sm text-green-700"></div>
          <div id="pm-expiry" class="mt-2 text-sm text-orange-600"></div>
          <p id="pm-desc" class="mt-3 text-sm text-gray-700"></p>

          <div class="mt-4">
            <label id="order-quantity-label" class="block text-sm font-medium">Quantité</label>
            <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-2 gap-2">
              <select id="pm-variant" class="mt-1 block w-full border rounded p-2"></select>
              <span id="pm-variant-stock" class="text-sm text-gray-600"></span>
              <div class="w-full sm:w-auto">
                <label for="order-quantity" class="sr-only">Quantité</label>
                <input id="order-quantity" type="number" min="1" value="1" class="w-full sm:w-24 border rounded p-2" />
                <div id="order-quantity-feedback" class="text-sm text-red-600 mt-1"></div>
              </div>
            </div>
          </div>

          <form id="order-form" class="mt-4 space-y-3 max-h-[48vh] overflow-y-auto pr-2">
            <h3 class="text-md font-medium">Passer commande</h3>
            <input id="order-name" type="text" placeholder="Nom complet" class="w-full border rounded p-2" required />
            <select id="order-city" class="w-full border rounded p-2">
              <option value="">Sélectionnez une ville</option>
              <option>Casablanca</option>
              <option>Rabat</option>
              <option>Marrakech</option>
              <option>Fès</option>
              <option>Tangier</option>
              <option>Agadir</option>
              <option>Meknès</option>
              <option>Oujda</option>
              <option>Kénitra</option>
              <option>Tétouan</option>
            </select>
            <div class="flex space-x-2">
              <input id="order-phone" type="tel" placeholder="Téléphone" inputmode="numeric" maxlength="10" class="w-40 border rounded p-2" />
            </div>
            <div>
              <button id="order-submit" type="button" class="bg-blue-600 text-white px-4 py-2 rounded">Valider la commande</button>
            </div>
            <div id="order-feedback" class="text-sm mt-1"></div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase compat scripts (allow running directly via file:// without module imports) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <!-- Lottie for animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>

  <!-- Loader overlay -->
  <div id="loader-overlay" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 flex flex-col items-center shadow-lg">
      <div id="loader-lottie" style="width:280px;height:160px"></div>
      <div class="mt-3 text-sm text-gray-700">Chargement...</div>
    </div>
  </div>

  <!-- Result overlay (success / error) -->
  <div id="result-overlay" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg w-80 p-6 shadow-lg text-center">
      <div id="tick-lottie" style="width:140px;height:140px;margin:0 auto"></div>
      <div id="cross-lottie" style="width:140px;height:140px;margin:0 auto;display:none"></div>
      <div id="result-message" class="mt-3 text-sm text-gray-800"></div>
    </div>
  </div>

    <!-- Pack composer modal -->
    <div id="pack-modal" class="fixed inset-0 bg-black/40 hidden flex items-center justify-center z-50">
      <div class="bg-white rounded-lg w-full max-w-3xl sm:w-11/12 p-4 sm:p-6 shadow-lg max-h-[85vh] overflow-y-auto">
        <div class="flex justify-between items-start">
          <h2 class="text-lg font-semibold">Composer un pack</h2>
          <button id="pack-close" class="text-gray-500 hover:text-gray-800">✕</button>
        </div>
        <div class="mt-4">
          <p class="text-sm text-gray-600">Sélectionnez plusieurs produits et définissez la quantité pour chacun.</p>
        </div>
        <!-- Step 1: product selection -->
        <div id="pack-step-1">
          <div class="mt-4">
            <div id="pack-products" class="space-y-3 max-h-56 overflow-y-auto border rounded p-2"></div>
          </div>
          <div class="mt-4 flex justify-end">
            <div id="pack-feedback" class="text-sm text-red-600 mr-auto"></div>
            <button id="pack-next" class="bg-green-600 text-white px-4 py-2 rounded">Suivant</button>
          </div>
        </div>

        <!-- Step 2: contact & confirmation -->
        <div id="pack-step-2" style="display:none">
          <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium">Votre nom</label>
              <input id="pack-name" type="text" class="w-full border rounded p-2" />
            </div>
            <div>
              <label class="block text-sm font-medium">Ville (livraison)</label>
              <select id="pack-city" class="w-full border rounded p-2"></select>
            </div>
          </div>
          <div class="mt-4">
            <label class="block text-sm font-medium">Téléphone</label>
            <input id="pack-phone" type="tel" inputmode="numeric" maxlength="10" class="w-full sm:w-64 border rounded p-2" />
          </div>
          <div class="mt-4 flex items-center justify-between">
            <div>
              <div id="pack-delivery" class="text-sm text-gray-700"></div>
              <div id="pack-total" class="text-lg font-semibold mt-1">Total: 0 DH</div>
              <div id="pack-feedback-step2" class="text-sm text-red-600 mt-1"></div>
            </div>
            <div class="flex items-center space-x-2">
              <button id="pack-back" class="bg-gray-200 text-gray-800 px-4 py-2 rounded">Retour</button>
              <button id="pack-submit" class="bg-blue-600 text-white px-4 py-2 rounded w-full sm:w-auto">Valider le pack</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Orders history modal -->
    <div id="orders-modal" class="fixed inset-0 bg-black/40 hidden flex items-center justify-center z-50">
      <div class="bg-white rounded-lg w-full max-w-3xl sm:w-11/12 p-4 sm:p-6 shadow-lg max-h-[85vh] overflow-y-auto">
        <div class="flex justify-between items-start mb-4">
          <h2 class="text-lg font-semibold">Historique de commandes</h2>
          <button id="orders-close" class="text-gray-500 hover:text-gray-800">✕</button>
        </div>
        <div class="mt-4">
          <div id="orders-list" class="space-y-4"></div>
          <div id="orders-empty" class="text-center text-gray-600 py-8">
            <p class="text-sm">Aucune commande sauvegardée.</p>
          </div>
         
        </div>
       
      </div>
    </div>

  <!-- About section -->
  <!-- Footer -->
  <footer class="bg-white border-t border-[color:var(--sand)]">
    <div class="max-w-7xl mx-auto px-6 py-12">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div>
          <h3 class="text-sm uppercase tracking-[0.3em] mb-4">Besoin d'aide</h3>
          <ul class="space-y-3 text-sm text-neutral-600">
            <li><a class="hover:underline" href="BESOIN_DAIDE/faq.html">FAQs</a></li>
            <li><a class="hover:underline" href="BESOIN_DAIDE/conditions-generales-vente.html">Conditions generales de vente</a></li>
            <li><a class="hover:underline" href="BESOIN_DAIDE/politique-confidentialite.html">Politique de confidentialite</a></li>
            <li><a class="hover:underline" href="BESOIN_DAIDE/conditions-acheminement.html">Conditions d'acheminement</a></li>
            <li><a class="hover:underline" href="BESOIN_DAIDE/conditions-utilisation.html">Conditions d'utilisation</a></li>
            <li><a class="hover:underline" href="BESOIN_DAIDE/contact.html">Contactez-nous</a></li>
          </ul>
        </div>

        <div class="md:col-span-2">
          <h3 class="text-sm uppercase tracking-[0.3em] mb-4">Newsletter</h3>
          <p class="text-sm text-neutral-600 mb-4">Inscrivez-vous a notre newsletter pour recevoir des offres exclusives.</p>
          <form id="newsletter-form" class="flex flex-col sm:flex-row sm:items-center gap-3">
            <input id="newsletter-email" type="email" placeholder="E-mail" required class="input-clean flex-1" />
            <button type="submit" id="newsletter-submit" class="ghost-btn">S'inscrire</button>
          </form>
          <div id="newsletter-feedback" class="text-sm mt-3 text-neutral-500"></div>
        </div>
      </div>

      <div class="mt-8 section-divider pt-6 flex flex-col sm:flex-row sm:items-center sm:justify-between text-neutral-500">
        <div class="text-sm">© <span id="year"></span> AURORA. Tous droits reserves.</div>
        <div class="mt-4 sm:mt-0 flex space-x-4">
          <a class="hover:underline" href="#" aria-label="Instagram">Instagram</a>
          <a class="hover:underline" href="#" aria-label="TikTok">TikTok</a>
          <a class="hover:underline" href="#" aria-label="WhatsApp">WhatsApp</a>
        </div>
      </div>
    </div>
  </footer>
  <!-- Firebase Scripts (compat) -->
  <script src="https://www.gstatic.com/firebasejs/compat/8.10.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/compat/8.10.1/firebase-firestore-compat.js"></script>
  
  <script src="../backend/shop.js"></script>
  
  <!-- Pack animation button initialization -->
  <script>
    (function() {
      // Load box.json animation for mobile pack button
      const packLottieContainer = document.getElementById('pack-lottie');
      const packAnimationBtn = document.getElementById('pack-animation-btn');
      const desktopButton = document.getElementById('open-pack-btn');
      
      if (packLottieContainer && window.lottie) {
        // Fetch and load the box animation
        fetch('../assets/box.json')
          .then(response => response.json())
          .then(animationData => {
            const packLottieInstance = window.lottie.loadAnimation({
              container: packLottieContainer,
              renderer: 'svg',
              loop: true,
              autoplay: true,
              animationData: animationData
            });
            
            // Make the animation clickable to trigger the pack modal
            if (packAnimationBtn) {
              packAnimationBtn.addEventListener('click', function() {
                const openPackBtn = document.getElementById('open-pack-btn');
                if (openPackBtn && typeof openPackBtn.click === 'function') {
                  openPackBtn.click();
                }
              });
            }
          })
          .catch(err => console.warn('Failed to load pack animation:', err));
      }
    })();
  </script>
  
  <!-- Orders management with localStorage -->
  <script>
    (function() {
      const ORDERS_STORAGE_KEY = 'aurora_orders';
      const ordersBtn = document.getElementById('orders-btn');
      const ordersModal = document.getElementById('orders-modal');
      const ordersClose = document.getElementById('orders-close');
      const ordersList = document.getElementById('orders-list');
      const ordersEmpty = document.getElementById('orders-empty');
      const ordersClear = document.getElementById('orders-clear');

      // Save order to localStorage
      window.saveOrderToLocalStorage = function(orderData) {
        try {
          const orders = JSON.parse(localStorage.getItem(ORDERS_STORAGE_KEY)) || [];
          orderData.timestamp = new Date().toISOString();
          orderData.id = Math.random().toString(36).substr(2, 9);
          orders.push(orderData);
          localStorage.setItem(ORDERS_STORAGE_KEY, JSON.stringify(orders));
          console.log('Order saved to localStorage:', orderData);
        } catch (e) {
          console.warn('Failed to save order to localStorage:', e);
        }
      };

      // Load and display orders
      function loadOrders() {
        try {
          const orders = JSON.parse(localStorage.getItem(ORDERS_STORAGE_KEY)) || [];
          ordersList.innerHTML = '';
          
          if (orders.length === 0) {
            ordersEmpty.style.display = 'block';
            if (ordersClear) ordersClear.style.display = 'none';
          } else {
            ordersEmpty.style.display = 'none';
            if (ordersClear) ordersClear.style.display = 'block';
            
            orders.reverse().forEach(order => {
              const orderDiv = document.createElement('div');
              orderDiv.className = 'border rounded-lg p-4 bg-white shadow-sm';
              
              // Afficher uniquement les produits avec image, nom et prix
              let productsList = '';
              if (order.products && Array.isArray(order.products)) {
                productsList = order.products.map(p => {
                  const qty = p.quantity || p.qty || 1;
                  const price = p.price || 0;
                  const variant = p.variant ? ` (${p.variant})` : '';
                  const imageUrl = p.imageUrl || 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100"%3E%3Crect fill="%23ddd" width="100" height="100"/%3E%3Ctext x="50" y="50" text-anchor="middle" dy=".3em" fill="%23999" font-size="12"%3ENo Image%3C/text%3E%3C/svg%3E';
                  
                  return `
                    <div class="flex items-center space-x-3 border-b pb-3 mb-3">
                      <img src="${imageUrl}" alt="${p.name}" class="w-20 h-20 object-cover rounded flex-shrink-0" />
                      <div class="flex-1">
                        <p class="font-semibold text-gray-800">${p.name}${variant}</p>
                        <p class="text-sm text-gray-600">Quantité: ${qty}</p>
                        <p class="text-lg font-bold text-blue-600">${price} DH</p>
                      </div>
                    </div>
                  `;
                }).join('');
              }
              
              orderDiv.innerHTML = `
                <div class="space-y-2">
                  ${productsList}
                </div>
              `;
              ordersList.appendChild(orderDiv);
            });
          }
        } catch (e) {
          console.warn('Failed to load orders from localStorage:', e);
          ordersEmpty.style.display = 'block';
          if (ordersClear) ordersClear.style.display = 'none';
        }
      }

      // Open orders modal
      if (ordersBtn) {
        ordersBtn.addEventListener('click', function() {
          if (ordersModal) {
            ordersModal.classList.remove('hidden');
            loadOrders();
          }
        });
      }

      // Close orders modal
      if (ordersClose) {
        ordersClose.addEventListener('click', function() {
          if (ordersModal) {
            ordersModal.classList.add('hidden');
          }
        });
      }

      // Clear all orders
      if (ordersClear) {
        ordersClear.addEventListener('click', function() {
          if (confirm('Êtes-vous sûr de vouloir effacer tout l\'historique des commandes ?')) {
            localStorage.removeItem(ORDERS_STORAGE_KEY);
            loadOrders();
          }
        });
      }

      // Close modal when clicking outside
      if (ordersModal) {
        ordersModal.addEventListener('click', function(e) {
          if (e.target === ordersModal) {
            ordersModal.classList.add('hidden');
          }
        });
      }
    })();
  </script>
  
  <script>
    // Set current year
    try { document.getElementById('year').textContent = new Date().getFullYear(); } catch(e){}

    // Newsletter behaviour: use existing showResult() if available, otherwise fallback
    (function(){
      const form = document.getElementById('newsletter-form');
      const email = document.getElementById('newsletter-email');
      const feedback = document.getElementById('newsletter-feedback');
      if(!form) return;
      form.addEventListener('submit', function(ev){
        ev.preventDefault();
        const val = (email && email.value || '').trim();
        if(!val || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(val)){
          feedback.textContent = 'Veuillez entrer un e-mail valide.';
          return;
        }
        feedback.textContent = '';
        // Try to save newsletter to Firestore if firebase is initialized
        try {
          if(window.firebase && typeof firebase.firestore === 'function'){
            firebase.firestore().collection('newsletter').add({ email: val, createdAt: firebase.firestore.FieldValue.serverTimestamp() })
              .then(()=>{
                if(typeof showResult === 'function'){ showResult(true, 'Merci — vous êtes inscrit·e !'); }
                else { feedback.textContent = 'Merci — vous êtes inscrit·e !'; email.value = ''; }
              }).catch(err=>{
                console.error(err);
                if(typeof showResult === 'function'){ showResult(false, 'Erreur — impossible d\'enregistrer.'); }
                else { feedback.textContent = 'Erreur — impossible d\'enregistrer. Réessayez.'; }
              });
            return;
          }
        } catch(e){ console.error(e); }

        if(typeof showResult === 'function'){
          showResult(true, 'Merci — vous êtes inscrit·e !');
        } else {
          feedback.textContent = 'Merci — vous êtes inscrit·e !';
          email.value = '';
        }
      });
    })();
  </script>
</body>
</html>
